<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Library search</title>
</head>
<body>
    <form method="post">{% csrf_token %}</form>
    <label for="fname">Enter radius distance in km:</label>
    <input type="text" id="kmDis" name="kmDis"><br><br>
    <button class="coordinates">Find Nearby Libraries</button>
    <div class="librarylist">

    </div>

    <script src="{% static 'js/jquery-3.6.0.min.js' %}" ></script>
    <script>
        $('.coordinates').click(function (){

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {

                        let token = $("input[name='csrfmiddlewaretoken']").val();
                        let x=$('#kmDis').val()

                        $.ajax({
                            url: "{% url "library_search:location_processing" %}",
                            type: "POST",
                            data: {
                                csrfmiddlewaretoken: token,
                                lo: position.coords.longitude,
                                la: position.coords.latitude,
                                dis: x
                            },
                            success: function(data) {
                                    $(".librarylist").html(data);
                            }
                        });

                    },
                    function(error) {
                        if (error.code == error.PERMISSION_DENIED)
                            console.log("you denied me :-(");
                        $(".librarylist").html("<p>Allow location access to see nearby libraries. Go to Settings>Site settings>Locations to give location access to the website</p>");
                      });
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            }
        );
    </script>
</body>
</html>

